var express=require("express"),router=express.Router(),formidable=require("formidable"),fs=require("fs"),AVATAR_UPLOAD_FOLDER="/avatar/";router.get("/index.html",function(e,r){r.render("upfile.ejs",{title:"上传文件123"})}),router.post("/postup",function(e,r){var a=new formidable.IncomingForm;a.encoding="utf-8",a.uploadDir="public"+AVATAR_UPLOAD_FOLDER,a.keepExtensions=!0,a.maxFieldsSize=2097152,a.parse(e,function(e,i,n){if(e)return r.locals.error=e,void r.render("index",{title:TITLE});var t="";switch(n.fulAvatar.type){case"image/pjpeg":t="jpg";break;case"image/jpeg":t="jpg";break;case"image/png":t="png";break;case"image/x-png":t="png"}if(0==t.length)return r.locals.error="只支持png和jpg格式图片",void r.render("index",{title:TITLE});var o=Math.random()+"."+t,s=a.uploadDir+o;console.log(s),fs.renameSync(n.fulAvatar.path,s)}),r.locals.success="上传成功",r.render("index",{title:TITLE})}),module.exports=router;